{% load static %}

<link rel="stylesheet" href="{% static 'restaurant/style.css' %}">

<div class="menu-container">
    <h1 class="page-title">Manage Menu</h1>

    <!-- ÿ≤ÿ± ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿµÿ± ÿ¨ÿØŸäÿØ -->
    <button class="add-item-btn" onclick="toggleAddForm()">+ Add New Item</button>

    <!-- ŸÅŸàÿ±ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© -->
    <div id="add-form" class="add-form hidden">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="add_item" value="1">
            {{ form.as_p }}
            <button class="add-submit-btn">Add Item</button>
        </form>
    </div>

    <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿπŸÜÿßÿµÿ± -->
    <div class="menu-grid">
        {% for item in menu_items %}
        <div class="menu-card">

            <!-- ÿßŸÑÿµŸàÿ±ÿ© + ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ -->
            <div class="menu-main">
                {% if item.image %}
                    <img src="{{ item.image.url }}" class="menu-image">
                {% else %}
                    <div class="menu-image placeholder"></div>
                {% endif %}

                <div class="menu-info">
                    <h3 class="menu-name">{{ item.name }}</h3>
                    <p class="menu-desc">{{ item.description }}</p>
                    <p class="menu-price">Price: {{ item.price }} SAR</p>
                    <p class="menu-category">Category: {{ item.get_category_display }}</p>

                    <p class="menu-status">
                        Status:
                        {% if item.is_available %}
                            <span class="status available">Available</span>
                        {% else %}
                            <span class="status unavailable">Unavailable</span>
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ -->
            <div class="menu-actions">

                <!-- ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸàÿØÿßŸÑ -->
                <button onclick="openEditModal({{ item.id }})" class="btn-small btn-edit">‚úé Edit</button>

                <!-- ÿ≠ÿ∞ŸÅ -->
                <a href="{% url 'delete_menu_item' item.id %}" 
                   class="delete-btn"
                   onclick="return confirm('Are you sure you want to delete this item?');">
                   üóë Delete
                </a>

                <!-- ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≠ÿßŸÑÿ© -->
                <a href="{% url 'toggle_availability' item.id %}" class="btn-small btn-toggle">‚ü≥ Toggle</a>
            </div>

        </div>
        {% empty %}
        <p class="empty-msg">No menu items added yet.</p>
        {% endfor %}
    </div>
</div>


<!-- ‚≠ê‚≠ê‚≠ê Popup Modal (Edit) ‚≠ê‚≠ê‚≠ê -->
<div id="editModal" class="modal hidden">
    <div class="modal-content">

        <h2 class="modal-title">Edit Item</h2>

        <form id="editForm" method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- ŸáŸÜÿß ÿ™ŸÜÿ≠ÿ∑ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÑŸä ÿ™ÿ¨Ÿä ŸÖŸÜ Django -->
            <div id="editFormFields"></div>

            <!-- ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© -->
            <div class="modal-actions">
                <button type="submit" class="btn-save">Save</button>
                <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
            </div>
        </form>

    </div>
</div>


<!-- JavaScript -->
<script>

function toggleAddForm() {
    document.getElementById("add-form").classList.toggle("hidden");
}

/* ‚≠ê ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ™ÿπÿØŸäŸÑ */
function openEditModal(itemId) {
    fetch(`/manager/menu/edit/${itemId}/`)
        .then(response => response.text())
        .then(html => {
            document.getElementById("editFormFields").innerHTML = html;
            document.getElementById("editForm").action = `/manager/menu/edit/${itemId}/`;
            document.getElementById("editModal").classList.remove("hidden");
        });
}

/* ‚≠ê ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ */
function closeModal() {
    document.getElementById("editModal").classList.add("hidden");
}

</script>

