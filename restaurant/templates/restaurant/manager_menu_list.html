{% load static %}

<link rel="stylesheet" href="{% static 'restaurant/style.css' %}">

<div class="menu-container">
    <h1 class="page-title">Manage Menu</h1>

    <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ -->
    <button class="add-item-btn" onclick="toggleAddForm()">+ Add New Item</button>

    <!-- ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
    <div id="add-form" class="add-form hidden">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="add_item" value="1">
            {{ form.as_p }}
            <button class="add-submit-btn">Add Item</button>
        </form>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
    <div class="menu-grid">
        {% for item in menu_items %}
        <div class="menu-card">

            <!-- Ø§Ù„ØµÙˆØ±Ø© + Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
            <div class="menu-main">
                {% if item.image %}
                    <img src="{{ item.image.url }}" class="menu-image">
                {% else %}
                    <div class="menu-image placeholder"></div>
                {% endif %}

                <div class="menu-info">
                    <h3 class="menu-name">{{ item.name }}</h3>
                    <p class="menu-desc">{{ item.description }}</p>
                    <p class="menu-price">Price: {{ item.price }} SAR</p>
                    <p class="menu-category">Category: {{ item.get_category_display }}</p>

                    <p class="menu-status">
                        Status:
                        {% if item.is_available %}
                            <span class="status available">Available</span>
                        {% else %}
                            <span class="status unavailable">Unavailable</span>
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
            <div class="menu-actions">

                <!-- ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
                <button onclick="openEditModal({{ item.id }})" class="btn-small btn-edit">âœ Edit</button>

                <!-- Ø­Ø°Ù -->
                <a href="{% url 'delete_menu_item' item.id %}" 
                   class="delete-btn"
                   onclick="return confirm('Are you sure you want to delete this item?');">
                   ğŸ—‘ Delete
                </a>

                <!-- ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
                <a href="{% url 'toggle_availability' item.id %}" class="btn-small btn-toggle">âŸ³ Toggle</a>
            </div>

        </div>
        {% empty %}
        <p class="empty-msg">No menu items added yet.</p>
        {% endfor %}
    </div>
</div>


<!-- â­â­â­ Popup Modal (Edit) â­â­â­ -->
<div id="editModal" class="modal hidden">
    <div class="modal-content">
        <h2>Edit Item</h2>

        <form id="editForm" method="POST" enctype="multipart/form-data">
            <!-- âš ï¸ Ù…Ù‡Ù…: Ù„Ø§ Ù†Ø¶Ø¹ csrf Ù‡Ù†Ø§ -->
            <div id="editFormFields"></div>

            <button class="add-submit-btn" type="submit">Save</button>
            <button type="button" class="close-btn" onclick="closeModal()">Cancel</button>
        </form>
    </div>
</div>


<!-- JavaScript -->
<script>

/* ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ ÙÙˆØ±Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
function toggleAddForm() {
    document.getElementById("add-form").classList.toggle("hidden");
}

/* â­ ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
function openEditModal(itemId) {
    fetch(`/manager/menu/edit/${itemId}/`)
        .then(response => response.text())
        .then(html => {
            // Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø¬Ø§Ù‡Ø² Ø§Ù„Ù„ÙŠ ÙŠØ±Ø³Ù„Ù‡ Django
            document.getElementById("editFormFields").innerHTML = html;

            // ØªØ­Ø¯ÙŠØ¯ Ù…ÙƒØ§Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ±Ù…
            document.getElementById("editForm").action = `/manager/menu/edit/${itemId}/`;

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
            document.getElementById("editModal").classList.remove("hidden");
        });
}

/* Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
function closeModal() {
    document.getElementById("editModal").classList.add("hidden");
}

</script>

